var fs = require( "fs" );
var jimp = require( "jimp" );

var { promisify } = require('util');
var sizeOf = promisify(require('image-size'));

var dir = "/Users/cpark/Documents/Books_PDF/신암행어사/신 암행어사 01권/";
var flip = true;

fs.readdir( dir, ( err, files ) => {

	files.forEach( file_name => {
		if ( file_name.indexOf( "." ) > 0 && file_name.toLowerCase().indexOf( ".zip" ) == -1 ) {
			crop( dir, file_name );
		}
	});
});



var crop = function( dir, file_name ) {

	console.log( dir + file_name );

	sizeOf( dir + file_name ).
	then( dimensions => {

		const width = dimensions.width;
		const height = dimensions.height;
		const width_2 = parseInt( width / 2 );
		console.log( width, height );

		const file_name_result = file_name.split( "." )[ 0 ];

		if ( width < 1000 ) {
			jimp.
			read( dir + file_name ).
			then( img => {
				img.
				// flip( true, false ).
				write( dir + "results/" + file_name_result + "__1.jpg" );
			});
		} else {

			jimp.
			read( dir + file_name ).
			then( img => {

				img.
				// flip( true, false ).
				crop( 0, 0, width_2, height ).
				write( dir + "results/" + file_name_result + ( flip ? "__2.jpg" : "__1.jpg" ) );

			});

			jimp.
			read( dir + file_name ).
			then( img => {

				img.
				// flip( true, false ).
				crop( width_2, 0, width_2, height ).
				write( dir + "results/" + file_name_result + ( flip ? "__1.jpg" : "__2.jpg" ) );

			});
		}

	}).
	catch( err => console.error(err));
}

